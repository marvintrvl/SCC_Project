{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\nexport default {\n  data() {\n    return {\n      cartItems: [],\n      cartTotal: 0,\n      user: {},\n      bankInfo: ''\n    };\n  },\n  methods: {\n    fetchCartItems() {\n      axios.get('http://127.0.0.1:5002/get-cart', {\n        headers: {\n          Authorization: `Bearer ${this.$store.state.authToken}`\n        }\n      }).then(response => {\n        // Log raw API response \n        console.log('API Response:', response.data);\n        const cartItems = response.data.cart_items;\n        console.log('First Item:', cartItems[0]);\n        const firstItem = cartItems[0];\n        console.log('First item photo ID:', firstItem.photo_id);\n\n        // Log cart items separately \n        console.log('Cart Items:', cartItems);\n        this.cartItems = cartItems;\n        this.cartTotal = response.data.total_price;\n      }).catch(error => {\n        console.error('Error fetching cart items:', error);\n      });\n    },\n    fetchUserInfo() {\n      axios.get('http://127.0.0.1:5000/profile', {\n        headers: {\n          Authorization: `Bearer ${this.$store.state.authToken}`\n        }\n      }).then(response => {\n        this.user = response.data;\n      }).catch(error => {\n        console.error('Error fetching user information:', error);\n      });\n    },\n    placeOrder() {\n      const orderDetails = this.cartItems.map(item => {\n        if (item.photo) {\n          return {\n            quantity: item.quantity,\n            size: item.photo.size,\n            photo_name: item.photo.name,\n            photo_id: item.photo_id,\n            // Corrected from item.photo_id\n            subtotal: item.photo.price\n          };\n        } else {\n          console.error('Item photo is undefined:', item);\n          return null;\n        }\n      }).filter(orderDetail => orderDetail !== null);\n      const orderData = {\n        total_price: this.cartTotal,\n        shipping_address: `${this.user.street}, ${this.user.postal_code}, ${this.user.city}, ${this.user.country}`,\n        bank_info: this.bankInfo,\n        order_details: orderDetails\n      };\n      axios.post('http://127.0.0.1:5004/place-order', orderData, {\n        headers: {\n          Authorization: `Bearer ${this.$store.state.authToken}`\n        }\n      }).then(response => {\n        console.log('Order placed successfully:', response.data);\n        this.$router.push(`/order-success/${response.data.photo_id}`);\n        // Clear the user's cart after placing the order\n        axios.delete('http://127.0.0.1:5002/clear-cart', {\n          headers: {\n            Authorization: `Bearer ${this.$store.state.authToken}`\n          }\n        }).then(clearResponse => {\n          console.log('Cart cleared successfully:', clearResponse.data);\n          // Optionally, you can navigate to a thank you page or perform other actions\n        }).catch(clearError => {\n          console.error('Error clearing cart:', clearError);\n          // Handle error while clearing the cart\n        });\n      }).catch(error => {\n        console.error('Error placing order:', error);\n        // Handle error, show a message to the user, etc.\n      });\n    }\n  },\n  created() {\n    this.fetchCartItems();\n    this.fetchUserInfo();\n  }\n};","map":{"version":3,"names":["axios","data","cartItems","cartTotal","user","bankInfo","methods","fetchCartItems","get","headers","Authorization","$store","state","authToken","then","response","console","log","cart_items","firstItem","photo_id","total_price","catch","error","fetchUserInfo","placeOrder","orderDetails","map","item","photo","quantity","size","photo_name","name","subtotal","price","filter","orderDetail","orderData","shipping_address","street","postal_code","city","country","bank_info","order_details","post","$router","push","delete","clearResponse","clearError","created"],"sources":["C:\\Users\\menzm\\Desktop\\SCC_Project\\frontend\\src\\views\\CheckoutView.vue"],"sourcesContent":["<template>\r\n  <div class=\"max-w-md mx-auto mt-8\">\r\n    <h1 class=\"text-3xl font-bold mb-4\">Checkout</h1>\r\n\r\n    <div class=\"mb-4\">\r\n      <h2 class=\"text-2xl font-bold mb-2\">Order Details</h2>\r\n      <table class=\"border-collapse border border-gray-800 w-full\">\r\n        <thead>\r\n          <tr class=\"bg-gray-800 text-white\">\r\n            <th class=\"py-2 px-4\">Photo</th>\r\n            <th class=\"py-2 px-4\">Size</th>\r\n            <th class=\"py-2 px-4\">Quantity</th>\r\n            <th class=\"py-2 px-4\">Subtotal</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr v-for=\"item in cartItems\" :key=\"item.id\">\r\n            <td class=\"py-2 px-4\">{{ item.photo.name }}</td>\r\n            <td class=\"py-2 px-4\">{{ item.photo.size }}</td>\r\n            <td class=\"py-2 px-4\">{{ item.quantity }}</td>\r\n            <td class=\"py-2 px-4\">${{ item.photo.price }}</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n    <p class=\"text-xl font-bold mb-2\">Total: ${{ cartTotal }}</p>\r\n\r\n    <div class=\"mb-4\">\r\n      <div class=\"border border-gray-800 p-4\">\r\n        <h2 class=\"text-2xl font-bold mb-2\">Shipping Information</h2>\r\n        <!-- Display user's shipping information -->\r\n        <p><span class=\"font-bold\">Street:</span> {{ user.street }}</p>\r\n        <p><span class=\"font-bold\">Postal Code:</span> {{ user.postal_code }}</p>\r\n        <p><span class=\"font-bold\">City:</span> {{ user.city }}</p>\r\n        <p><span class=\"font-bold\">Country:</span> {{ user.country }}</p>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"mb-4\">\r\n      <div class=\"border border-gray-800 p-4\">\r\n        <h2 class=\"text-2xl font-bold mb-2\">Bank Information</h2>\r\n        <!-- Allow the user to enter bank information -->\r\n        <form @submit.prevent=\"placeOrder\">\r\n          <label for=\"bankInfo\" class=\"block text-white mb-2\">Enter Bank Information:</label>\r\n          <textarea v-model=\"bankInfo\" name=\"bankInfo\" class=\"rounded-md px-4 py-2 w-full bg-gray-800 text-white resize-none\" maxlength=\"30\" rows=\"1\" required></textarea>\r\n          <button type=\"submit\" class=\"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded\">Place Order</button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      cartItems: [],\r\n      cartTotal: 0,\r\n      user: {},\r\n      bankInfo: '',\r\n    };\r\n  },\r\n  methods: {\r\n    fetchCartItems() {\r\n      axios.get('http://127.0.0.1:5002/get-cart', {\r\n        headers: {\r\n          Authorization: `Bearer ${this.$store.state.authToken}`,\r\n        },\r\n      })\r\n      .then(response => {\r\n        // Log raw API response \r\n        console.log('API Response:', response.data);\r\n\r\n        const cartItems = response.data.cart_items;\r\n        console.log('First Item:', cartItems[0]);\r\n        const firstItem = cartItems[0];\r\n        console.log('First item photo ID:', firstItem.photo_id);\r\n\r\n        // Log cart items separately \r\n        console.log('Cart Items:', cartItems);\r\n\r\n        this.cartItems = cartItems;\r\n        this.cartTotal = response.data.total_price;\r\n      })\r\n      .catch(error => {\r\n        console.error('Error fetching cart items:', error);  \r\n      });\r\n    },\r\n    fetchUserInfo() {\r\n      axios.get('http://127.0.0.1:5000/profile', {\r\n        headers: {\r\n          Authorization: `Bearer ${this.$store.state.authToken}`,\r\n        },\r\n      })\r\n      .then(response => {\r\n        this.user = response.data;\r\n      })\r\n      .catch(error => {\r\n        console.error('Error fetching user information:', error);\r\n      });\r\n    },\r\n    placeOrder() {\r\n      const orderDetails = this.cartItems.map(item => {\r\n        if (item.photo) {\r\n          return {\r\n            quantity: item.quantity,\r\n            size: item.photo.size,\r\n            photo_name: item.photo.name,\r\n            photo_id: item.photo_id,  // Corrected from item.photo_id\r\n            subtotal: item.photo.price,\r\n          };\r\n        } else {\r\n          console.error('Item photo is undefined:', item);\r\n          return null;\r\n        }\r\n      }).filter(orderDetail => orderDetail !== null);\r\n\r\n      const orderData = {\r\n        total_price: this.cartTotal,\r\n        shipping_address: `${this.user.street}, ${this.user.postal_code}, ${this.user.city}, ${this.user.country}`,\r\n        bank_info: this.bankInfo,\r\n        order_details: orderDetails,\r\n      };\r\n\r\n      axios.post('http://127.0.0.1:5004/place-order', orderData, {\r\n        headers: {\r\n          Authorization: `Bearer ${this.$store.state.authToken}`,\r\n        },\r\n      })\r\n      .then(response => {\r\n        console.log('Order placed successfully:', response.data);\r\n\r\n        this.$router.push(`/order-success/${response.data.photo_id}`);\r\n        // Clear the user's cart after placing the order\r\n        axios.delete('http://127.0.0.1:5002/clear-cart', {\r\n          headers: {\r\n            Authorization: `Bearer ${this.$store.state.authToken}`,\r\n          },\r\n        })\r\n        .then(clearResponse => {\r\n          console.log('Cart cleared successfully:', clearResponse.data);\r\n          // Optionally, you can navigate to a thank you page or perform other actions\r\n        })\r\n        .catch(clearError => {\r\n          console.error('Error clearing cart:', clearError);\r\n          // Handle error while clearing the cart\r\n        });\r\n      })\r\n      .catch(error => {\r\n        console.error('Error placing order:', error);\r\n        // Handle error, show a message to the user, etc.\r\n      });\r\n    },\r\n  },\r\n\r\n  created() {\r\n    this.fetchCartItems();\r\n    this.fetchUserInfo();\r\n  },\r\n};\r\n</script>\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}